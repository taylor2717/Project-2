---
title: "project2"
format: html
editor: visual
---

```{r}
install.packages('janitor')
```

```{r}
library(dplyr)
library(ggplot2)
library(readr)
library(tidyr)


DATA_PATH <- "data/nfl_play_by_play_2009_2016.csv"
if(file.exists(DATA_PATH)){
D <- read_csv(DATA_PATH, show_col_types = FALSE)
} else {
D <- ggplot2::diamonds |> as.data.frame()
}


# Helpers
is_numeric_like <- function(x){ is.numeric(x) || (is.character(x) && suppressWarnings(!any(is.na(as.numeric(x))))) }
NUMS <- names(D)[vapply(D, is_numeric_like, logical(1))]
CATS <- setdiff(names(D), NUMS)
if(length(CATS) < 2){
D$auto_group <- cut(suppressWarnings(as.numeric(D[[NUMS[1]]])), breaks = 3)
CATS <- c(CATS, "auto_group")
}
```

```{r}
# One-way
oneway <- D |> count(.data[[CATS[1]]], name = "n") |> mutate(pct = round(100*n/sum(n),2))
oneway


# Two-way
library(janitor)
twoway <- D |> tabyl(.data[[CATS[1]]], .data[[CATS[2]]]) |> adorn_totals("row") |> adorn_totals("col")
twoway
```

```{r}
summ <- D |> group_by(.data[[CATS[1]]]) |>
summarise(across(all_of(NUMS[1:min(3,length(NUMS))]), list(n = ~sum(!is.na(.)), mean = ~mean(as.numeric(.), na.rm=TRUE), sd = ~sd(as.numeric(.), na.rm=TRUE)), .names = "{.col}_{.fn}"))
summ
```

```{r}
# 2) Stacked bar colored by second categorical
D |> ggplot(aes(x = .data[[CATS[1]]], fill = .data[[CATS[2]]])) + geom_bar(position = "stack") + labs(title = "Stacked counts") + theme_minimal()
```

```{r}
# 3) Boxplot by group
D |> ggplot(aes(x = .data[[CATS[1]]], y = suppressWarnings(as.numeric(.data[[NUMS[1]]])))) + geom_boxplot() + labs(title = "Boxplot") + theme_minimal()
```

```{r}
# 4) Scatter of two numeric variables, colored by categorical
if(length(NUMS) >= 2){
D |> ggplot(aes(x = suppressWarnings(as.numeric(.data[[NUMS[1]]])), y = suppressWarnings(as.numeric(.data[[NUMS[2]]])), color = .data[[CATS[1]]])) +
geom_point(alpha = 0.5) + labs(title = "Scatter (two numerics)") + theme_minimal()
}
```

```{r}
# 5) Faceted bar
D |> ggplot(aes(x = .data[[CATS[1]]])) + geom_bar() + facet_wrap(vars(.data[[CATS[2]]])) + labs(title = "Faceted bar") + theme_minimal()
```

```{r}
# 6) Heatmap of two cats (counts)
D2 <- D |> count(.data[[CATS[1]]], .data[[CATS[2]]]); names(D2) <- c("rows","cols","n")
D2 |> ggplot(aes(x = cols, y = rows, fill = n)) + geom_tile() + labs(title = "Heatmap") + theme_minimal()
```
